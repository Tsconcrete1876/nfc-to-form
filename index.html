<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>NFC to Google Form</title>
</head>
<body>
  <h2>請掃描 NFC 標籤...</h2>
  <p id="status">等待中...</p>
  <button onclick="readNFC()">開始掃描 NFC</button>

  <script>
    async function readNFC() {
      if ("NDEFReader" in window) {
        const ndef = new NDEFReader();
        try {
          await ndef.scan();
          document.getElementById("status").textContent = "請靠近 NFC 標籤...";
          ndef.onreading = event => {
            console.log("NFC 標籤讀取成功:", event);
            const record = event.message.records[0];
            console.log("NFC 內容:", record);

            // 嘗試手動轉換字節數組為字串
            const uint8Array = new Uint8Array(record.data);
            const id = String.fromCharCode.apply(null, uint8Array);
            console.log("解析出的 NFC ID:", id);

            alert(record.data + "\n" + encodeURIComponent(record.data));

            // 顯示讀取的 ID
            document.getElementById("status").textContent = "讀取成功，跳轉中...";
            
            // 替換為你的 Google 表單連結 + entry ID
            const formUrl = "https://docs.google.com/forms/d/e/1FAIpQLSdKsWLR_cKG67z7wAmF80Igz9muqyX6F8JHqB_E6JAwG4C6PQ/formResponse?entry.2015421160=" + encodeURIComponent(id);
                             
            window.location.href = formUrl;
          };
        } catch (error) {
          document.getElementById("status").textContent = "NFC 錯誤：" + error;
        }
      } else {
        document.getElementById("status").textContent = "這台裝置不支援 Web NFC。請使用 Android Chrome。";
      }
    }
  </script>
</body>
</html>
